Refactor sync pipeline to fix a race condition with multiple synchronous syncs.
